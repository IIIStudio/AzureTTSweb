<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure TTS æ–‡æœ¬è½¬è¯­éŸ³</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: row;
            gap: 20px;
            padding: 20px;
            background-color: #e8e4d4;
        }
        .left-panel, .right-panel {
            flex: 1;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        .left-panel {
            max-width: 50%;
        }
        .right-panel {
            max-width: 50%;
        }
        textarea {
            width: calc(100% - 24px);
            height: 150px;
            padding: 10px;
            font-size: 13px;
            border: 2px solid #000000;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            color: #525151;
            background-color: #e8e4d4;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            border: 2px solid #acaba3;
        }
        button:hover {
            border: 2px solid #525151;
        }
        .voice-button, .style-button {
            margin: 5px;
            padding: 5px;
            font-size: 10px;
            cursor: pointer;
            border: 2px solid #ccc;
            border-radius: 5px;
        }
        .voice-button.selected, .style-button.selected {
            background-color: #5f573f;
            color: white;
        }
        .slider-container {
            margin: 20px 0;
        }
        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .slider {
            width: 100%;
        }
        .config-input {
            margin-bottom: 20px;
        }
        .config-input label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .config-input input {
            width: calc(100% - 24px);
            padding: 10px;
            font-size: 16px;
            border: 2px solid #cbc09f;
            border-radius: 5px;
        }
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5f573f;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* é»˜è®¤éšè— */
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .button-container {
            display: flex;
            align-items: center;
        }
    </style>
<style id="appStyles">
  /* ç»Ÿä¸€æ»‘å—æ ·å¼ï¼ˆè¯­é€Ÿ/è¯­è°ƒï¼‰ */
  .slider {
    -webkit-appearance: none; appearance: none;
    height: 10px; border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.14);
    outline: none;
  }
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 18px; height: 18px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .slider::-moz-range-thumb {
    width: 18px; height: 18px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .slider:focus {
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    border-color: rgba(56,189,248,.6);
  }

  /* æ ‡é¢˜å·¦ä¾§å›¾æ ‡ï¼ˆç»Ÿä¸€ç±»æ ·å¼ï¼‰ */
  .title-row { display:flex; align-items:center; gap:10px; }
  .title-icons { display:inline-flex; align-items:center; gap:8px; }
  .title-icons a {
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 8px; border-radius:8px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,.16);
    color:#fff; text-decoration:none;
    transition: all .2s ease;
  }
  .title-icons a:hover { background:#13213b; border-color:rgba(255,255,255,.3); transform: translateY(-1px); }
  .title-icons svg, .title-icons img { width:20px; height:20px; }

  /* è‡ªå®šä¹‰æ’­æ”¾å™¨ï¼ˆè¿›åº¦ä¸éŸ³é‡æ»‘å—ä¿æŒåŒé£æ ¼ï¼‰ */
  .ap-bar, .ap-vol {
    -webkit-appearance: none; appearance: none;
    height: 8px; border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.14);
    outline: none;
  }
  .ap-bar::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 16px; height: 16px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .ap-bar::-moz-range-thumb {
    width: 16px; height: 16px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .ap-vol::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 14px; height: 14px; border-radius: 50%;
    background: #f59e0b; border: 2px solid #d97706;
    box-shadow: 0 0 0 3px rgba(245,158,11,.25);
    cursor: pointer;
  }
  .ap-vol::-moz-range-thumb {
    width: 14px; height: 14px; border-radius: 50%;
    background: #f59e0b; border: 2px solid #d97706;
    box-shadow: 0 0 0 3px rgba(245,158,11,.25);
    cursor: pointer;
  }
  /* æ·±è‰²æ»šåŠ¨æ¡ï¼ˆWebKit/Chromium æµè§ˆå™¨ï¼‰ */
  ::-webkit-scrollbar { width: 10px; height: 10px; }
  ::-webkit-scrollbar-track {
    background: rgba(255,255,255,.08);
    border-radius: 10px;
  }
  ::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #1f2d4a, #13213b);
    border: 2px solid rgba(255,255,255,.15);
    border-radius: 10px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #243554, #162746);
    border-color: rgba(255,255,255,.25);
  }
  /* Firefox æ»šåŠ¨æ¡ */
  * {
    scrollbar-width: thin;
    scrollbar-color: #243554 rgba(255,255,255,.10);
  }

  /* åˆå¹¶è¦†ç›–æ ·å¼ï¼ˆæ·±è‰²èƒŒæ™¯ã€æŒ‰é’®ã€è¾“å…¥ç­‰ï¼‰ */
  body {
    background: radial-gradient(1200px 600px at 80% -100%, rgba(56,189,248,0.2), transparent), linear-gradient(135deg, #0f172a, #1e293b 60%, #0b1220) !important;
    color: #fff !important;
  }
  .left-panel, .right-panel {
    background: rgba(0,0,0,.22) !important;
    border: 1px solid rgba(255,255,255,.12) !important;
  }
  textarea, input {
    background: rgba(0,0,0,.28) !important;
    border: 1px solid rgba(255,255,255,.16) !important;
    color: #fff !important;
  }
  .button-container button,
  button,
  .voice-button,
  .style-button {
    background: #111c32 !important;
    color: #fff !important;
    border: 1px solid rgba(255,255,255,.22) !important;
    padding: 10px 18px !important;
    font-size: 15px !important;
    border-radius: 10px !important;
    font-weight: 700 !important;
    box-shadow: 0 2px 8px rgba(0,0,0,.25) !important;
  }
  .button-container button:hover,
  button:hover,
  .voice-button:hover,
  .style-button:hover {
    background: #13213b !important;
    border-color: rgba(255,255,255,.3) !important;
    box-shadow: 0 3px 10px rgba(0,0,0,.3) !important;
  }
  .voice-button.selected,
  .style-button.selected {
    background: #1f2d4a !important;
    border-color: rgba(56,189,248,.7) !important;
    box-shadow: 0 0 0 2px rgba(56,189,248,.25) inset, 0 3px 10px rgba(0,0,0,.35) !important;
    color: #fff !important;
  }
  .voice-button,
  .style-button {
    padding: 8px 12px !important;
    font-size: 13px !important;
  }

  /* åˆå¹¶æ’­æ”¾å™¨æ ·å¼ï¼ˆå¡ç‰‡ä¸æŒ‰é’®ï¼‰ */
  .audio-card {
    margin-top: 20px;
    background: rgba(15,23,42,.9);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    box-shadow: 0 10px 40px rgba(0,0,0,.4);
    padding: 12px;
  }
  #audioPlayer { display: none; } /* éšè—åŸç”Ÿæ§ä»¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰ UI */
  .audio-ui { display: flex; flex-direction: column; gap: 10px; }
  .audio-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .ap-btn {
    background: #111c32;
    color: #fff;
    border: 1px solid rgba(255,255,255,.16);
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    font-size: 14px;
    transition: background .2s ease, border-color .2s ease, transform .06s ease;
  }
  .ap-btn:hover { background: #13213b; border-color: rgba(255,255,255,.3); }
  .ap-btn:active { transform: translateY(1px); }
  .ap-time { min-width: 120px; font-variant-numeric: tabular-nums; opacity: .9; }

</style>
</head>
<body>
    <!-- å·¦ä¾§é¢æ¿ï¼šæ–‡æœ¬è¾“å…¥å’Œè¯­éŸ³åˆæˆ -->
    <div class="left-panel">
        <h2 class="title-row">
          <span class="title-icons">
            <a href="https://github.com/IIIStudio/AzureTTSweb" target="_blank" rel="noopener noreferrer" aria-label="å‰å¾€ GitHub ä»“åº“">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff" d="M12 .5a12 12 0 0 0-3.79 23.41c.6.11.82-.26.82-.58v-2.02c-3.35.73-4.06-1.61-4.06-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.75.08-.74.08-.74 1.2.09 1.83 1.23 1.83 1.23 1.07 1.83 2.8 1.3 3.49.99.11-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.51.12-3.15 0 0 1.01-.32 3.3 1.23.96-.27 1.99-.4 3.01-.4s2.05.14 3.01.4c2.29-1.55 3.3-1.23 3.3-1.23.66 1.64.25 2.85.12 3.15.77.84 1.24 1.91 1.24 3.22 0 4.61-2.8 5.63-5.47 5.93.43.37.81 1.1.81 2.22v3.29c0 .32.22.7.83.58A12 12 0 0 0 12 .5Z"/>
              </svg>
            </a>
            <a href="https://cnb.cool/IIIStudio/HTML/AzureTTSweb/" target="_blank" rel="noopener noreferrer" aria-label="å‰å¾€ AzureTTSweb æ–‡æ¡£é¡µé¢">
              <img src="https://docs.cnb.cool/images/logo/svg/LogoColorfulIcon.svg" alt="CNB Logo">
            </a>
          </span>
          <span>æ–‡æœ¬è½¬è¯­éŸ³</span>
        </h2>
        <div class="config-input">
            <label for="subscriptionKeyInput">Azure è®¢é˜…å¯†é’¥ï¼š</label>
            <input type="password" id="subscriptionKeyInput" placeholder="è¾“å…¥æ‚¨çš„ Azure è®¢é˜…å¯†é’¥">
        </div>
        <div class="config-input">
            <label for="regionInput">Azure åŒºåŸŸï¼š</label>
            <input type="text" id="regionInput" placeholder="è¾“å…¥æ‚¨çš„ Azure åŒºåŸŸï¼ˆä¾‹å¦‚ï¼šeastusï¼‰">
        </div>
        <textarea id="textInput" placeholder="è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬..."></textarea>
        <div class="button-container">
            <button onclick="synthesizeSpeech()">åˆæˆè¯­éŸ³</button>
            <div id="loader" class="loader"></div>
        </div>
        <!-- è‡ªå®šä¹‰éŸ³é¢‘æ’­æ”¾å™¨ï¼ˆæ›¿æ¢åŸç”Ÿ controlsï¼‰ -->
        <div class="audio-card">
            <audio id="audioPlayer"></audio>
            <div class="audio-ui">
                <div class="audio-row">
                    <button id="apPlay" class="ap-btn" aria-label="æ’­æ”¾">â–¶ï¸ æ’­æ”¾</button>
                    <div class="ap-time"><span id="apCur">00:00</span> / <span id="apDur">00:00</span></div>
                    <button id="apMute" class="ap-btn" aria-label="é™éŸ³">ğŸ”ˆ å£°éŸ³</button>
                    <input id="apVol" class="ap-vol" type="range" min="0" max="1" step="0.01" value="1" aria-label="éŸ³é‡">
                    <button id="apDl" class="ap-btn" aria-label="ä¸‹è½½" title="ä¸‹è½½éŸ³é¢‘">â¬‡ï¸ ä¸‹è½½</button>
                </div>
                <input id="apBar" class="ap-bar" type="range" min="0" max="100" step="0.1" value="0" aria-label="æ’­æ”¾è¿›åº¦">
            </div>
        </div>
    </div>

    <!-- å³ä¾§é¢æ¿ï¼šè¯­éŸ³ã€é£æ ¼ã€è¯­é€Ÿã€è¯­è°ƒè®¾ç½® -->
    <div class="right-panel">
        <!-- è¯­éŸ³é€‰æ‹© -->
        <h3>é€‰æ‹©è¯­éŸ³ï¼š</h3>
        <div id="voicesContainer"></div>

        <!-- é£æ ¼é€‰æ‹© -->
        <h3>é€‰æ‹©é£æ ¼ï¼š(æ²¡æœ‰æˆ–è€…ä¸é€‰å°±æ˜¯é»˜è®¤ï¼)</h3>
        <div id="stylesContainer"></div>

        <!-- è¯­é€Ÿè®¾ç½® -->
        <div class="slider-container">
            <label for="rateSlider">è¯­é€Ÿ (0.5 - 2.0)ï¼š<span id="rateValue">1.0</span></label>
            <input type="range" id="rateSlider" class="slider" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateRateValue()">
        </div>

        <!-- è¯­è°ƒè®¾ç½® -->
        <div class="slider-container">
            <label for="pitchSlider">è¯­è°ƒ (0.5 - 2.0)ï¼š<span id="pitchValue">1.0</span></label>
            <input type="range" id="pitchSlider" class="slider" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updatePitchValue()">
        </div>
    </div>

    <script>
        let subscriptionKey = '';
        let region = '';
        const endpoint = `https://${region}.tts.speech.microsoft.com/cognitiveservices/voices/list`;
        const ttsEndpoint = `https://${region}.tts.speech.microsoft.com/cognitiveservices/v1`;

        let voices = []; // å­˜å‚¨æ‰€æœ‰è¯­éŸ³æ•°æ®
        let selectedVoice = null; // å½“å‰é€‰ä¸­çš„è¯­éŸ³
        let selectedStyle = null; // å½“å‰é€‰ä¸­çš„é£æ ¼
        let rate = 1.0; // è¯­é€Ÿ
        let pitch = 1.0; // è¯­è°ƒ

        // é¡µé¢åŠ è½½æ—¶ä» localStorage åŠ è½½é…ç½®
        window.onload = () => {
            loadConfig();
            loadVoices();
        };

        // ä» localStorage åŠ è½½é…ç½®
        function loadConfig() {
            subscriptionKey = localStorage.getItem('subscriptionKey') || '';
            region = localStorage.getItem('region') || '';
            document.getElementById('subscriptionKeyInput').value = subscriptionKey;
            document.getElementById('regionInput').value = region;

            const savedRate = localStorage.getItem('rate');
            if (savedRate) {
                rate = parseFloat(savedRate);
                document.getElementById('rateSlider').value = rate;
                document.getElementById('rateValue').textContent = rate;
            }

            const savedPitch = localStorage.getItem('pitch');
            if (savedPitch) {
                pitch = parseFloat(savedPitch);
                document.getElementById('pitchSlider').value = pitch;
                document.getElementById('pitchValue').textContent = pitch;
            }
        }

        // ä¿å­˜é…ç½®åˆ° localStorage
        function saveConfig() {
            localStorage.setItem('subscriptionKey', subscriptionKey);
            localStorage.setItem('region', region);
            localStorage.setItem('rate', rate);
            localStorage.setItem('pitch', pitch);
        }

        // è·å–è¯­éŸ³åˆ—è¡¨
        async function loadVoices() {
            subscriptionKey = document.getElementById('subscriptionKeyInput').value;
            region = document.getElementById('regionInput').value;

            if (!subscriptionKey || !region) {
                showTip('è¯·è¾“å…¥æ‚¨çš„ Azure è®¢é˜…å¯†é’¥å’ŒåŒºåŸŸ');
                return;
            }

            try {
                const response = await fetch(`https://${region}.tts.speech.microsoft.com/cognitiveservices/voices/list`, {
                    method: 'GET',
                    headers: {
                        'Ocp-Apim-Subscription-Key': subscriptionKey
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯ï¼ status: ${response.status}`);
                }

                const allVoices = await response.json();
                // è¿‡æ»¤å‡ºä¸­å›½çš„è¯­éŸ³ï¼ˆè¯­è¨€ä»£ç ä¸º zh- æˆ– CNï¼‰
                voices = allVoices.filter(voice => voice.Locale.toLowerCase().startsWith('zh') || voice.Locale.toUpperCase().includes('CN'));
                populateVoiceButtons(voices);
            } catch (error) {
                console.error('Error fetching voices:', error);
            }
        }

        // å¡«å……è¯­éŸ³æŒ‰é’®
        function populateVoiceButtons(voices) {
            const container = document.getElementById('voicesContainer');
            container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨

            voices.forEach(voice => {
                const button = document.createElement('button');
                button.className = 'voice-button';

                // åˆ é™¤ LocalName ä¸­çš„æ‹¬å·å†…å®¹
                const localName = voice.LocalName.replace(/\(.*?\)/g, '').trim();

                // ç¿»è¯‘æ€§åˆ«
                const gender = voice.Gender === 'Female' ? 'å¥³' : 'ç”·';

                // è®¾ç½®æŒ‰é’®æ–‡æœ¬
                button.textContent = `${localName} - ${gender}`;

                button.dataset.shortName = voice.ShortName; // å­˜å‚¨è¯­éŸ³çš„ ShortName
                button.onclick = () => onVoiceButtonClick(voice, button);
                container.appendChild(button);
            });
        }

        // å½“ç‚¹å‡»è¯­éŸ³æŒ‰é’®æ—¶
        function onVoiceButtonClick(voice, button) {
            // ç§»é™¤ä¹‹å‰é€‰ä¸­æŒ‰é’®çš„æ ·å¼
            const buttons = document.querySelectorAll('.voice-button');
            buttons.forEach(btn => btn.classList.remove('selected'));

            // ä¸ºå½“å‰é€‰ä¸­çš„æŒ‰é’®æ·»åŠ æ ·å¼
            button.classList.add('selected');

            // è®¾ç½®å½“å‰é€‰ä¸­çš„è¯­éŸ³
            selectedVoice = voice;

            // æ˜¾ç¤ºæ”¯æŒçš„é£æ ¼
            populateStyleButtons(voice);
        }

        // å¡«å……é£æ ¼æŒ‰é’®
        function populateStyleButtons(voice) {
            const container = document.getElementById('stylesContainer');
            container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨

            // é£æ ¼ç¿»è¯‘æ˜ å°„è¡¨
            const styleTranslations = {
                'assistant': 'åŠ©æ‰‹',
                'chat': 'èŠå¤©',
                'customerservice': 'å®¢æœ',
                'newscast': 'æ–°é—»æ’­æŠ¥',
                'affectionate': 'æ·±æƒ…',
                'angry': 'ç”Ÿæ°”',
                'calm': 'å¹³é™',
                'cheerful': 'æ¬¢å¿«',
                'disgruntled': 'ä¸æ»¡',
                'fearful': 'å®³æ€•',
                'gentle': 'æ¸©æŸ”',
                'lyrical': 'æŠ’æƒ…',
                'sad': 'æ‚²ä¼¤',
                'serious': 'ä¸¥è‚ƒ',
                'poetry-reading': 'è¯—æ­Œæœ—è¯µ',
                'friendly': 'å‹å¥½',
                'chat-casual': 'éšæ„èŠå¤©',
                'whispering': 'è€³è¯­',
                'sorry': 'æŠ±æ­‰',
                'excited': 'å…´å¥‹',
                'embarrassed': 'å°´å°¬',
                'depressed': 'æ²®ä¸§',
                'envious': 'ç¾¡æ…•',
                'empathetic': 'åŒæƒ…å¿ƒ',
                'story': 'å™äº‹',
                'narration-professional': 'ä¸“ä¸šæ—ç™½',
                'newscast-casual': 'æ–°é—»å¹¿æ’­ - ä¼‘é—²',
                'livecommercial': 'ç°åœºå¹¿å‘Š',
                'advertisement-upbeat': 'å¹¿å‘Š - ä¹è§‚',
                'sports-commentary': 'ä½“è‚²è§£è¯´',
                'sports-commentary-excited': 'æ¿€æƒ…ä½“è‚²è§£è¯´',
                'documentary-narration': 'çºªå½•ç‰‡æ—ç™½',
                'narration-relaxed': 'è½»æ¾å™è¿°'
                // å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šé£æ ¼ç¿»è¯‘
            };

            if (voice.StyleList && voice.StyleList.length > 0) {
                voice.StyleList.forEach(style => {
                    const button = document.createElement('button');
                    button.className = 'style-button';
                    // ç¿»è¯‘é£æ ¼åç§°
                    const translatedStyle = styleTranslations[style.toLowerCase()] || style;
                    button.textContent = translatedStyle;
                    button.onclick = () => onStyleButtonClick(style, button);
                    container.appendChild(button);
                });
            } else {
                const message = document.createElement('p');
                message.textContent = 'è¯¥è¯­éŸ³ä¸æ”¯æŒä»»ä½•é£æ ¼ã€‚';
                container.appendChild(message);
            }
        }

        // å½“ç‚¹å‡»é£æ ¼æŒ‰é’®æ—¶
        function onStyleButtonClick(style, button) {
            // ç§»é™¤ä¹‹å‰é€‰ä¸­æŒ‰é’®çš„æ ·å¼
            const buttons = document.querySelectorAll('.style-button');
            buttons.forEach(btn => btn.classList.remove('selected'));

            // ä¸ºå½“å‰é€‰ä¸­çš„æŒ‰é’®æ·»åŠ æ ·å¼
            button.classList.add('selected');

            // è®¾ç½®å½“å‰é€‰ä¸­çš„é£æ ¼
            selectedStyle = style;
        }

        // æ›´æ–°è¯­é€Ÿæ˜¾ç¤º
        function updateRateValue() {
            rate = document.getElementById('rateSlider').value;
            document.getElementById('rateValue').textContent = rate;
            saveConfig();
        }

        // æ›´æ–°è¯­è°ƒæ˜¾ç¤º
        function updatePitchValue() {
            pitch = document.getElementById('pitchSlider').value;
            document.getElementById('pitchValue').textContent = pitch;
            saveConfig();
        }

        // åˆæˆè¯­éŸ³
        async function synthesizeSpeech() {
            if (!selectedVoice) {
                showTip('è¯·å…ˆé€‰æ‹©å£°éŸ³');
                return;
            }

            const text = document.getElementById('textInput').value;
            if (!text) {
                showTip('è¯·è¾“å…¥ä¸€äº›æ–‡å­—');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            const loader = document.getElementById('loader');
            loader.style.display = 'inline-block';

            const ssml = `
                <speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' 
                       xmlns:mstts='http://www.w3.org/2001/mstts' xml:lang='${selectedVoice.Locale}'>
                    <voice name='${selectedVoice.ShortName}'>
                        <prosody rate='${rate * 100 - 100}%' pitch='${(pitch - 1) * 50}%'>
                            ${selectedStyle ? `<mstts:express-as style="${selectedStyle}">${text}</mstts:express-as>` : text}
                        </prosody>
                    </voice>
                </speak>
            `;

            try {
                const response = await fetch(`https://${region}.tts.speech.microsoft.com/cognitiveservices/v1`, {
                    method: 'POST',
                    headers: {
                        'Ocp-Apim-Subscription-Key': subscriptionKey,
                        'Content-Type': 'application/ssml+xml',
                        'X-Microsoft-OutputFormat': 'audio-16khz-128kbitrate-mono-mp3'
                    },
                    body: ssml
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = audioUrl;
                audioPlayer.play();
            } catch (error) {
                console.error('Error synthesizing speech:', error);
                showTip('åˆæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°');
            } finally {
                // éšè—åŠ è½½åŠ¨ç”»
                loader.style.display = 'none';
            }
        }

        // ç›‘å¬è®¢é˜…å¯†é’¥å’ŒåŒºåŸŸçš„è¾“å…¥å˜åŒ–
        document.getElementById('subscriptionKeyInput').addEventListener('input', (e) => {
            subscriptionKey = e.target.value;
            saveConfig();
        });

        document.getElementById('regionInput').addEventListener('input', (e) => {
            region = e.target.value;
            saveConfig();
        });
    // åˆå¹¶ï¼šæç¤ºå¼¹çª—ä¸è‡ªå®šä¹‰æ’­æ”¾å™¨è„šæœ¬ï¼ˆæ•´ç†ä¸ºå•ä¸€è„šæœ¬å—ï¼‰
    // å±…ä¸­æç¤ºå¼¹çª—
    function showTip(msg) {
      var ov = document.getElementById('tipOverlay');
      var box = document.getElementById('tipMessage');
      if (ov && box) {
        box.textContent = msg || '';
        ov.style.display = 'block';
      }
    }
    function hideTip() {
      var ov = document.getElementById('tipOverlay');
      if (ov) ov.style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded', function () {
      var btn = document.getElementById('tipCloseBtn');
      var ov = document.getElementById('tipOverlay');
      if (btn) btn.addEventListener('click', hideTip);
      if (ov) ov.addEventListener('click', function (e) {
        if (e.target === ov) hideTip();
      });
    });

    // è‡ªå®šä¹‰æ’­æ”¾å™¨é€»è¾‘ï¼šæ’­æ”¾/æš‚åœã€è¿›åº¦ã€æ—¶é—´ã€éŸ³é‡ã€é™éŸ³ã€ä¸‹è½½
    (function() {
      const A = {
        audio: document.getElementById('audioPlayer'),
        playBtn: document.getElementById('apPlay'),
        muteBtn: document.getElementById('apMute'),
        cur: document.getElementById('apCur'),
        dur: document.getElementById('apDur'),
        bar: document.getElementById('apBar'),
        vol: document.getElementById('apVol'),
        dl: document.getElementById('apDl'),
      };
      if (!A.audio) return;

      function fmtTime(sec) {
        if (!isFinite(sec) || sec < 0) sec = 0;
        const m = Math.floor(sec / 60);
        const s = Math.floor(sec % 60);
        return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
      }
      function syncPlayBtn() {
        A.playBtn.textContent = A.audio.paused ? 'â–¶ï¸ æ’­æ”¾' : 'â¸ï¸ æš‚åœ';
      }
      function syncMuteBtn() {
        A.muteBtn.textContent = A.audio.muted ? 'ğŸ”‡ é™éŸ³' : 'ğŸ”ˆ å£°éŸ³';
      }
      function syncDur() {
        A.dur.textContent = fmtTime(A.audio.duration || 0);
        A.bar.max = (A.audio.duration || 0).toFixed(1);
      }
      function syncCur() {
        const t = A.audio.currentTime || 0;
        A.cur.textContent = fmtTime(t);
        A.bar.value = t.toFixed(1);
      }

      // äº‹ä»¶ç»‘å®š
      A.playBtn.addEventListener('click', function() {
        if (A.audio.src) {
          if (A.audio.paused) A.audio.play().catch(()=>{});
          else A.audio.pause();
          syncPlayBtn();
        }
      });
      A.muteBtn.addEventListener('click', function() {
        A.audio.muted = !A.audio.muted;
        syncMuteBtn();
      });
      A.vol.addEventListener('input', function() {
        A.audio.volume = parseFloat(A.vol.value || '1');
        if (A.audio.volume === 0) { A.audio.muted = true; } else { A.audio.muted = false; }
        syncMuteBtn();
      });
      A.bar.addEventListener('input', function() {
        const v = parseFloat(A.bar.value || '0');
        if (isFinite(v)) { A.audio.currentTime = v; }
      });
      A.audio.addEventListener('timeupdate', syncCur);
      A.audio.addEventListener('loadedmetadata', function() { syncDur(); syncCur(); });
      A.audio.addEventListener('play', syncPlayBtn);
      A.audio.addEventListener('pause', syncPlayBtn);
      A.audio.addEventListener('volumechange', syncMuteBtn);

      // ä¸‹è½½å½“å‰éŸ³é¢‘
      A.dl.addEventListener('click', function() {
        if (!A.audio.src) return;
        try {
          const a = document.createElement('a');
          a.href = A.audio.src;
          a.download = 'AzureTTS-Audio.mp3';
          document.body.appendChild(a); a.click();
          setTimeout(()=>{ a.remove(); }, 100);
        } catch (_) {}
      });

      // å½“åˆæˆåè®¾ç½®äº† srcï¼Œç«‹å³åŒæ­¥æ—¶é•¿ï¼ˆsynthesizeSpeech å®Œæˆåä¼šè®¾ç½® audioPlayer.srcï¼‰
      const _setSrc = function() { if (A.audio.readyState >= 1) { syncDur(); syncCur(); } };
      A.audio.addEventListener('canplay', _setSrc);
      A.audio.addEventListener('loadeddata', _setSrc);
    })();

    </script>
<!-- æç¤ºå¼¹çª—ï¼šå±…ä¸­æ˜¾ç¤ºï¼Œæ ·å¼ä¸ AzureTTSweb ä¿æŒä¸€è‡´ -->
<div id="tipOverlay" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.6);backdrop-filter:saturate(140%) blur(2px);">
  <div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(15,23,42,.95);border:1px solid rgba(255,255,255,.12);border-radius:14px;width:min(520px,90vw);max-width:520px;box-shadow:0 10px 40px rgba(0,0,0,.5);">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.08);">
      <div style="font-weight:700;">æç¤º</div>
      <button id="tipCloseBtn" style="padding:6px 10px;border-radius:8px;background:#111c32;color:#fff;border:1px solid rgba(255,255,255,.16);">å…³é—­</button>
    </div>
    <div id="tipMessage" style="padding:14px 16px;font-size:14px;color:#fff;"></div>
  </div>
</div>

<!-- è¦†ç›–æ ·å¼-->
<style media="not all">
  body {
    background: radial-gradient(1200px 600px at 80% -100%, rgba(56,189,248,0.2), transparent), linear-gradient(135deg, #0f172a, #1e293b 60%, #0b1220) !important;
    color: #fff !important;
  }
  .left-panel, .right-panel {
    background: rgba(0,0,0,.22) !important;
    border: 1px solid rgba(255,255,255,.12) !important;
  }
  textarea, input {
    background: rgba(0,0,0,.28) !important;
    border: 1px solid rgba(255,255,255,.16) !important;
    color: #fff !important;
  }
  .button-container button,
  button,
  .voice-button,
  .style-button {
    background: #111c32 !important;
    color: #fff !important;
    border: 1px solid rgba(255,255,255,.22) !important;
    padding: 10px 18px !important;
    font-size: 15px !important;
    border-radius: 10px !important;
    font-weight: 700 !important;
    box-shadow: 0 2px 8px rgba(0,0,0,.25) !important;
  }
  .button-container button:hover,
  button:hover,
  .voice-button:hover,
  .style-button:hover {
    background: #13213b !important;
    border-color: rgba(255,255,255,.3) !important;
  }
  .voice-button.selected,
  .style-button.selected {
    background: #1f2d4a !important;
    border-color: rgba(56,189,248,.6) !important;
    color: #fff !important;
  }
  /* æ›´æ˜¾çœ¼çš„æŒ‰é’®é€‰ä¸­æ€ä¸æ‚¬åœæ€ */
  .button-container button:hover,
  button:hover,
  .voice-button:hover,
  .style-button:hover {
    background: #13213b !important;
    border-color: rgba(255,255,255,.35) !important;
    box-shadow: 0 3px 10px rgba(0,0,0,.3) !important;
  }
  .voice-button.selected,
  .style-button.selected {
    background: #1f2d4a !important;
    border-color: rgba(56,189,248,.7) !important; /* é’è‰²é«˜äº® */
    box-shadow: 0 0 0 2px rgba(56,189,248,.25) inset, 0 3px 10px rgba(0,0,0,.35) !important;
  }
  .voice-button,
  .style-button {
    padding: 8px 12px !important;
    font-size: 13px !important;
  }

  /* éŸ³é¢‘æ’­æ”¾å™¨å¡ç‰‡åŒ–æ ·å¼ï¼ˆè·¨æµè§ˆå™¨å°½å¯èƒ½ç¾åŒ–ï¼‰ */
  #audioPlayer {
    width: 100% !important;
    margin-top: 20px !important;
    background: rgba(0,0,0,.28) !important;
    border: 1px solid rgba(255,255,255,.16) !important;
    border-radius: 12px !important;
    box-shadow: 0 10px 30px rgba(0,0,0,.25) inset, 0 6px 14px rgba(0,0,0,.25) !important;
    padding: 6px !important; /* éƒ¨åˆ†æµè§ˆå™¨å¯¹ audio å¤–æ¡†æœ‰æ•ˆ */
  }
  /* WebKit æ§ä»¶åŒºåŸŸï¼ˆChrome/Edge/Safariï¼‰ */
  audio::-webkit-media-controls-panel {
    background: transparent !important;
    border-radius: 10px !important;
  }
  audio::-webkit-media-controls-play-button,
  audio::-webkit-media-controls-pause-button,
  audio::-webkit-media-controls-mute-button,
  audio::-webkit-media-controls-volume-slider,
  audio::-webkit-media-controls-time-remaining-display,
  audio::-webkit-media-controls-current-time-display {
    filter: brightness(1.05) contrast(1.05) !important;
  }
  audio::-webkit-media-controls-enclosure {
    border-radius: 10px !important;
    overflow: hidden !important;
  }

  /* æ ‡é¢˜å·¦ä¾§å›¾æ ‡æ ·å¼ï¼ˆæ•´ç†å»å†…è”ï¼‰ */
  .title-row { display:flex; align-items:center; gap:10px; }
  .title-icons { display:inline-flex; align-items:center; gap:8px; }
  .title-icons a {
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 8px; border-radius:8px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,.16);
    color:#fff; text-decoration:none;
    transition: all .2s ease;
  }
  .title-icons a:hover { background:#13213b; border-color:rgba(255,255,255,.3); transform: translateY(-1px); }
  .title-icons svg, .title-icons img { width:20px; height:20px; }

  /* ç»Ÿä¸€æ»‘åŠ¨æ¡æ ·å¼ï¼ˆè¯­é€Ÿ/è¯­è°ƒï¼‰ */
  .slider {
    -webkit-appearance: none; appearance: none;
    height: 10px; border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.14);
    outline: none;
  }
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 18px; height: 18px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .slider::-moz-range-thumb {
    width: 18px; height: 18px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .slider:focus {
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    border-color: rgba(56,189,248,.6);
  }
</style>


<!-- è‡ªå®šä¹‰æ’­æ”¾å™¨æ ·å¼-->
<style media="not all">
  .audio-card {
    margin-top: 20px;
    background: rgba(15,23,42,.9);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    box-shadow: 0 10px 40px rgba(0,0,0,.4);
    padding: 12px;
  }
  #audioPlayer { display: none; } /* éšè—åŸç”Ÿæ§ä»¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰ UI */
  .audio-ui { display: flex; flex-direction: column; gap: 10px; }
  .audio-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .ap-btn {
    background: #111c32;
    color: #fff;
    border: 1px solid rgba(255,255,255,.16);
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    font-size: 14px;
    transition: background .2s ease, border-color .2s ease, transform .06s ease;
  }
  .ap-btn:hover { background: #13213b; border-color: rgba(255,255,255,.3); }
  .ap-btn:active { transform: translateY(1px); }
  .ap-time { min-width: 120px; font-variant-numeric: tabular-nums; opacity: .9; }
  .ap-bar {
    -webkit-appearance: none; appearance: none;
    width: 100%;
    height: 8px;
    border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.14);
    outline: none;
  }
  .ap-bar::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 16px; height: 16px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .ap-bar::-moz-range-thumb {
    width: 16px; height: 16px; border-radius: 50%;
    background: #38bdf8; border: 2px solid #0ea5e9;
    box-shadow: 0 0 0 3px rgba(56,189,248,.25);
    cursor: pointer;
  }
  .ap-vol {
    width: 120px;
    height: 8px;
    border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.14);
    outline: none;
  }
  .ap-vol::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 14px; height: 14px; border-radius: 50%;
    background: #f59e0b; border: 2px solid #d97706;
    box-shadow: 0 0 0 3px rgba(245,158,11,.25);
    cursor: pointer;
  }
  .ap-vol::-moz-range-thumb {
    width: 14px; height: 14px; border-radius: 50%;
    background: #f59e0b; border: 2px solid #d97706;
    box-shadow: 0 0 0 3px rgba(245,158,11,.25);
    cursor: pointer;
  }
</style>

</body>
</html>

